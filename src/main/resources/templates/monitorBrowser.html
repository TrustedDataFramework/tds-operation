<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="UTF-8">
		<title>浏览器监测</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="renderer" content="webkit">
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/style.css">

		<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>

	</head>
      
   <body class="body_main">
   	  <!--左边菜单-->
      <div id="sider" class="sider"></div>
	  <div class="wrapMain">
	  	 <!--头部-->
	  	 <div class="topInfo" id="topInfo">	  
	  	 </div>
	  	 <div class="mainBox">
	  	 	 <div class="tabBox tabBox_out browser_box">
		  	 	 <div class="borderRadius5 bosshdow boxdiv first_div">
		  	 	 	<h3 class="title">监测浏览器</h3>
		  	 	 	<div class="dataBox">
		  	 	 	   <div class="browser-info">
<!--						   <p>IP:<span id="ip"></span></p>-->
<!--						   <p>端口：8080</p>-->
						   <p>版本：<span id="version"></span></p>
						   <p>运行状态：<span id="status"></span></p>
						</div>
		 
						<div class="btnbox">
							<a class="btndefault borderRadius5 browser-btn" onclick="showModal(1)">停止</a>
							<a class="btndefault borderRadius5 browser-btn" onclick="showModal(2)">启动</a>
							<a class="btndefault borderRadius5 browser-btn" onclick="showModal(3)">重启</a>
							<a class="btndefault borderRadius5 browser-btn" id="search">访问</a>
						</div>
		  	 	 		
		  	 	 	</div>
		  	 	 </div>
	  	 	 </div>
	  	 	 <div class="space"></div>
	  	 </div>
	  </div>

<!--	  &lt;!&ndash;新增节点弹出框&ndash;&gt;-->
<!--	  <div class="modal browser-password" id="modal">-->
<!--		  <div class="modal-by-dialog modal-point">-->
<!--			  <a onclick="hideModal()" class="btnClose" style="color:#333333"></a>-->
<!--			  <h3 class="modal_title">密码确认</h3>-->
<!--			  <form class="form">-->
<!--				  <div class="col clearfix">-->

<!--					  <div class="fin"><input class="borderRadius5" type="text" placeholder="请输入密码" id="password"/></div>-->
<!--				  </div>-->

<!--				  <div class="fbtnbox">-->
<!--					  <a  class="borderRadius5 fbtn" onclick="hideModal()" id="submit">提交</a>-->
<!--				  </div>-->

<!--			  </form>-->
<!--		  </div>-->

<!--	  </div>-->

	  <div class="trans-modal">
		  <div class="trans-main">
			  <div class="trans-content">
				  <div class="loading"><img src="../img/load.gif"/></div>
				  <p class="mess"></p>
			  </div>
		  </div>
	  </div>

	  <div class="alert n-alert"></div>
   </body>

</html>
<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script>
	var ip;
 	$("#sider").load("/sider",function(){
 		$(".siderNav .l7").addClass('cur')
 	});
 	
 	$("#topInfo").load("/header")

	var type = ''
	var num = 0
	$("#sider").load("/sider",function(){
		$(".siderNav .l7").addClass('cur')
	});

	$("#topInfo").load("/header")
	function showModal(num){
		$.ajax({url:"nodeType",success:function(result1){
			if(result1.code != 2000){
				$('.alert').html('未绑定节点').addClass('alert-danger').show().delay(1500).fadeOut();
				return;
			}
				type = num;
				$.ajax({url:"checkShell1",success:function(result){
						if(result == null || result == ""){
							console.log(result)
							$('.alert').html('管理员密码错误').addClass('alert-danger').show().delay(1500).fadeOut();
							return;
						}
						if(type == 1){
							$(".mess").text("正在停止，请稍后...")
							$(".trans-modal").addClass('show-trans-modal');
							$.get('stopWeb', function (result) {
							}, 'json');
						}else if(type == 2){
							$(".mess").text("正在启动，请稍后...")
							$(".trans-modal").addClass('show-trans-modal');
							$.get('startWeb', function (result) {
							}, 'json');
						}else if(type == 3){
							$(".mess").text("正在重启，请稍后...")
							$(".trans-modal").addClass('show-trans-modal');
							$.get('restartWeb', function (result) {
							}, 'json');
						}
					}})

			}})

	}

	function hideModal(){
		$(".modal").removeClass('modal_in');
	}

	$(function () {
		$.get('getLocalIp', function (result) {
			if(result){
				ip = result.data;
			}
		}, 'json');

		getDetectExplorer();
	});

	// function hideModal(){
	// 	$(".modal").removeClass('modal_in');
	// 	//表示启动
	// 	if(type==1){
	// 		$(".trans-modal").addClass('show-trans-modal');
	// 	}
	// }

	function getDetectExplorer(){
		$.get('detectExplorer', function (result) {
			if(result.code == 2000){
				document.getElementById("version").innerHTML = result.data;
			}
			document.getElementById("status").innerHTML = result.message;
		}, 'json');
	}

	// $('#submit').click(function () {
	// 	var urlData = {password: $('#password').val()};
	// 	$(".modal").removeClass('modal_in');
	// 	//表示启动
	// 	$(".trans-modal").addClass('show-trans-modal');
	// 	if(type == 1) {
	// 		$.get('startWeb', urlData, function (result) {
	// 		}, 'json');
	// 	}else if (type ==2){
	// 		$.get('stopWeb',urlData, function (result) {
	// 		}, 'json');
	// 	}else if(type == 3){
	// 		$.get('restartWeb',urlData, function (result) {
	// 		}, 'json');
	// 	}
	// });

	// $('#startWeb').click(function () {
	// 	$(".trans-modal").addClass('show-trans-modal');
	// 	$.get('startWeb', function (result) {
	// 	}, 'json');
	// })
	//
	// $('#stopWeb').click(function () {
	// 	$(".trans-modal").addClass('show-trans-modal');
	// 	$.get('stopWeb', function (result) {
	// 	}, 'json');
	// })
	//
	// $('#restartWeb').click(function () {
	// 	$(".trans-modal").addClass('show-trans-modal');
	// 	$.get('restartWeb', function (result) {
	// 	}, 'json');
	// })

	$('#search').click(function () {
		$.get('webStartOrNot', function (result) {
			if (result.code == 2000) {
				let path = "http://" + ip + ":8181"
				window.open(path, "_blank");
			} else {
				$('.alert').html('请启动浏览器').addClass('alert-danger').show().delay(1500).fadeOut();
			}
		}, 'json');
	})

	setInterval(function() {
		if (type == 1) {
			$.get('webKillOrNot', function (result) {
				num++;
				if (result.code == 2000) {
					$(".trans-modal").removeClass('show-trans-modal');
					document.getElementById("version").innerHTML = "";
					document.getElementById("status").innerHTML = "未运行";
					type = '';
					num = '';
				}
				if(parseInt(num)>60){
					$('.alert').html('停止超时').addClass('alert-danger').show().delay(1500).fadeOut();
					$(".trans-modal").removeClass('show-trans-modal');
					type = '';
					num = '';
				}
			}, 'json');
		}else if (type == 2) {
			$.get('webStartOrNot', function (result) {
				num++;
				if (result.code == 2000) {
					$(".trans-modal").removeClass('show-trans-modal');
					document.getElementById("version").innerHTML = result.data;
					document.getElementById("status").innerHTML = result.message;
					type = '';
					num = '';
				}
				if(parseInt(num)>60){
					$('.alert').html('启动超时').addClass('alert-danger').show().delay(1500).fadeOut();
					$(".trans-modal").removeClass('show-trans-modal');
					type = '';
					num = '';
				}
			}, 'json');
		}
	},1000);

	setInterval(function() {
		if (type ==3) {
			num = parseInt(num) + 15;
			$.get('webStartOrNot', function (result) {
				if (result.code == 2000) {
					$(".trans-modal").removeClass('show-trans-modal');
					document.getElementById("version").innerHTML = result.data;
					document.getElementById("status").innerHTML = result.message;
					type = '';
					num = '';
				}
				if(parseInt(num)>100){
					$('.alert').html('重启超时').addClass('alert-danger').show().delay(1500).fadeOut();
					$(".trans-modal").removeClass('show-trans-modal');
					type = '';
					num = '';
				}
			}, 'json');
		}
	},15000);
</script>
